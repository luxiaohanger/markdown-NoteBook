# 前缀和
用于优化需要频繁计算区间元素和的问题
## 一维前缀和
最常用于返回区间元素之和。只需利用数学知识 S(b)-S(a-1)  
*注意 a==0 时单独讨论* -->利用空白起始保护，可以直接求解 
```cpp
vector<int> sum(n+1);
for(int i=1;i<=n;i++){
    sum[i]=sum[i-1]+arr[i-1];
}
```
## 二维前缀和
**二维前缀和**是二维数组中 **从左上角 (0,0) 到任意点 (i,j) 的矩形区域元素和**。

设有一个二维数组 `a`，定义二维前缀和数组 `sum`：

$$
sum[i][j] = \text{sum of all elements in rectangle from } (0,0) \text{ to } (i,j)
$$

公式：

$$
sum[i][j] = a[i][j] + sum[i-1][j] + sum[i][j-1] - sum[i-1][j-1]
$$

* `a[i][j]`：当前元素
* `sum[i-1][j]`：上方矩形和
* `sum[i][j-1]`：左方矩形和
* `sum[i-1][j-1]`：左上角矩形被重复加了，需要减掉

---



### 查询任意矩形和

如果想求矩形 `(x1,y1)` 到 `(x2,y2)` 的和：

$$
\text{rectSum} = sum[x2][y2] - sum[x1-1][y2] - sum[x2][y1-1] + sum[x1-1][y1-1]
$$

* 注意边界情况，当 `x1` 或 `y1` 为 0 时，需要额外判断或初始化 `sum` 时多加一行一列 0。**(推荐使用空白保护)**

---


```cpp
vector<vector<int>> sum(n+1,vector<int>(m+1)); // 多一行一列，方便处理边界

    // 构建二维前缀和
for(int i=1;i<=n;i++) {
    for(int j=1;j<=m;j++) {
        sum[i][j] = a[i-1][j-1] + sum[i-1][j] + sum[i][j-1] - sum[i-1][j-1];
        //此处从 sum[1][1] 开始，对应的是 a[0][0]
    }
}

    // 查询矩形和 (1,1) 到 (2,2)
int x1=1, y1=1, x2=2, y2=2;
int rectSum = sum[x2][y2] - sum[x1-1][y2] - sum[x2][y1-1] + sum[x1-1][y1-1];
```
**多一行一列，方便处理边界**  
这是构造二维表的惯用方法！此时  sum[i+1][j+1] 对应 a[i][j]
## 环形处理
有些问题涉及环形数组（即数组的首尾相连）。一个常见的技巧是将原数组复制一份并拼接在后面，然后在这个长度为 2n的新数组上运用前缀和技巧来 **模拟环形** 查询。





